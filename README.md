# enct (encoding task)

ìµœì ì˜ í™”ì§ˆê³¼ ìš©ëŸ‰ì„ ì¶”ì •í•´ ë¹„ë””ì˜¤ë¥¼ ì¸ì½”ë”©í•˜ëŠ” ffmpeg ê¸°ë°˜ ì¸ì½”ë”© ìë™í™” ë„êµ¬ì…ë‹ˆë‹¤.

## âœ¨ Features

### 1. ê°•ë ¥í•œ ë¹„ë””ì˜¤ ì¸ì½”ë”©

ffmpegì—ì„œ ì§€ì›í•˜ëŠ” ë‹¤ì–‘í•œ ì¸ì½”ë”© ì˜µì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.

- **ìµœì‹  ì½”ë± ì§€ì›**: `HEVC (H.265)`, `AV1` ë“± ìµœì‹  ë¹„ë””ì˜¤ ì½”ë±ì„ ì§€ì›í•˜ì—¬ ë†’ì€ ì••ì¶•ë¥ ê³¼ ë›°ì–´ë‚œ í™”ì§ˆì„ ì œê³µí•©ë‹ˆë‹¤.
- **GPU ê°€ì†**: NVIDIA ê·¸ë˜í”½ì¹´ë“œì˜ NVENCë¥¼ í™œìš©í•œ GPU ê°€ì†ì„ ì§€ì›í•©ë‹ˆë‹¤.
- **ë‹¤ì–‘í•œ ì¸ì½”ë”© ì˜µì…˜**: í•´ìƒë„ ë° í”„ë ˆì„ ë³€ê²½, ë¹„ë””ì˜¤ ìë¥´ê¸° ë“± FFmpegì˜ ê°•ë ¥í•œ ê¸°ëŠ¥ë“¤ì„ ì†ì‰½ê²Œ ì„¤ì •í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2. ì¸ì½”ë”© í€„ë¦¬í‹° ì¶”ì • (Encoding Quality Estimation) ê¸°ëŠ¥

ì‚¬ìš©ìì˜ ëª©í‘œ ìš©ëŸ‰ë¹„ë¥¼ ë¶„ì„í•˜ì—¬ ìµœì ì˜ ì¸ì½”ë”© í€„ë¦¬í‹°(e.g. CRF) ê°’ì„ ì¶”ì •í•©ë‹ˆë‹¤. ë™ì‘ ê³¼ì •ì„ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

1. **ì„ì˜ì˜ í€„ë¦¬í‹° ê°’(QP) ì„¤ì •**: ì„¤ì •ëœ í€„ë¦¬í‹° ë²”ìœ„ ë‚´ì—ì„œ ì„ì˜ì˜ ê°’(ìµœì´ˆì˜ ê²½ìš° í€„ë¦¬í‹° ë²”ìœ„ì˜ ì¤‘ì•™ê°’)ì„ ì„ íƒí•©ë‹ˆë‹¤.
2. **ì„¸ê·¸ë¨¼íŠ¸ ë¶„ì„**: ì „ì²´ ë¹„ë””ì˜¤ë¥¼ ì—¬ëŸ¬ ê°œ(nê°œ)ì˜ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë‚˜ëˆ„ê³ , ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ì•ë¶€ë¶„(xì´ˆ)ì„ ì„ì‹œë¡œ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
3. **ìš©ëŸ‰ë¹„ ë¹„êµ**: ì›ë³¸ ì„¸ê·¸ë¨¼íŠ¸ì™€ ì„ì‹œ ì¸ì½”ë”©ëœ ê²°ê³¼ë¬¼ì˜ ìš©ëŸ‰ë¹„ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.
4. **ìµœì  í€„ë¦¬í‹° íƒìƒ‰ (Binary Search)**: ëª©í‘œ ìš©ëŸ‰ë¹„ ë²”ìœ„ì— ë„ë‹¬í•  ë•Œê¹Œì§€ **ì´ì§„ íƒìƒ‰** ì•Œê³ ë¦¬ì¦˜ì„ í†µí•´ íš¨ìœ¨ì ìœ¼ë¡œ ë‹¤ìŒ í€„ë¦¬í‹° ê°’ì„ íƒìƒ‰í•©ë‹ˆë‹¤.
    - ì˜ˆ: í€„ë¦¬í‹° ë²”ìœ„ê°€ 20~48ì¼ ë•Œ, 34, 27, 22ì™€ ê°™ì´ ë²”ìœ„ë¥¼ ì¢í˜€ê°€ë©° ë¹ ë¥´ê²Œ ìµœì ê°’ì„ ì°¾ìŠµë‹ˆë‹¤.
5. **ëª¨ë“œì— ë”°ë¥¸ ìµœì¢… í€„ë¦¬í‹° ê²°ì •**: ëª©í‘œ ìš©ëŸ‰ë¹„ ë²”ìœ„ì— í•´ë‹¹í•˜ëŠ” í€„ë¦¬í‹° ê°’ì„ ì°¾ì€ í›„, ì‚¬ìš©ìê°€ ì„¤ì •í•œ ëª¨ë“œì— ë”°ë¼ ìµœì¢… í€„ë¦¬í‹° ê°’ì„ ì„ íƒí•©ë‹ˆë‹¤.
    - **Compression Mode**: ìš©ëŸ‰ë¹„ê°€ ê°€ì¥ **ë‚®ì€(ê°€ì¥ ì••ì¶•ë¥ ì´ ë†’ì€)** í€„ë¦¬í‹° ê°’ì„ ì„ íƒí•©ë‹ˆë‹¤.
    - **Quality Mode**: ìš©ëŸ‰ë¹„ê°€ ê°€ì¥ **ë†’ì€(ê°€ì¥ í™”ì§ˆì´ ì¢‹ì€)** í€„ë¦¬í‹° ê°’ì„ ì„ íƒí•©ë‹ˆë‹¤.

    > ì˜ˆ: ëª©í‘œ ìš©ëŸ‰ë¹„ ë²”ìœ„ê°€ 0.28 ~ 0.34ì¼ ê²½ìš°,
    > - `compression` ëª¨ë“œì—ì„œëŠ” 0.28ì— ê°€ì¥ ê°€ê¹Œìš´ í€„ë¦¬í‹° ê°’ì„ ìµœì¢…ì ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.
    > - `quality` ëª¨ë“œì—ì„œëŠ” 0.34ì— ê°€ì¥ ê°€ê¹Œìš´ í€„ë¦¬í‹° ê°’ì„ ìµœì¢…ì ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.

## ğŸ”§ Installation

### Linux

```sh
python -m venv .venv
.venv/bin/pip3 install -r requirements.txt
```

### Windows

```shell
python -m venv .venv
.venv\Scripts\pip.exe install -r requirements.txt
```

## âš™ï¸ Set Config File

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `config.yaml` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤.

```yaml
# --- ê²½ë¡œ ì„¤ì • ---
srcDirPath: <ì›ë³¸ ë¹„ë””ì˜¤ í´ë” ê²½ë¡œ>
outDirPath: <ê²°ê³¼ë¬¼ ì €ì¥ í´ë” ê²½ë¡œ>
tmpDirPath: <ì„ì‹œ íŒŒì¼ ìƒì„± í´ë” ê²½ë¡œ>

# --- ì¸ì½”ë”© ì„¤ì • ---
encoding:
  enableGpu: true          # GPU ê°€ì† ì‚¬ìš© ì—¬ë¶€ (true/false)
  videoCodec: av1          # ë¹„ë””ì˜¤ ì½”ë± (h265, av1 ë“±)
  videoQuality: ~          # í€„ë¦¬í‹° ì¶”ì • ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ê²½ìš° '~' ë˜ëŠ” ë¹„ì›Œë‘ 
  # videoQuality: 36       # íŠ¹ì • í€„ë¦¬í‹° ê°’ìœ¼ë¡œ ê³ ì •í•˜ë ¤ë©´ ì£¼ì„ í•´ì œ í›„ ê°’ ì…ë ¥
  videoPreset: "p4"        # ì¸ì½”ë”© í”„ë¦¬ì…‹ (ì¸ì½”ë”ì— ë”°ë¼ ë‹¤ë¦„)
  # audioCodec: opus         # ì˜¤ë””ì˜¤ ì½”ë± (ì„ íƒ ì‚¬í•­)
  # audioBitrateKb: 128k     # ì˜¤ë””ì˜¤ ë¹„íŠ¸ë ˆì´íŠ¸ (ì„ íƒ ì‚¬í•­)
  # videoFrame: 30           # í”„ë ˆì„ ë³€ê²½ (ì„ íƒ ì‚¬í•­)
  # videoMaxBitrate: 6000    # ìµœëŒ€ ë¹„ë””ì˜¤ ë¹„íŠ¸ë ˆì´íŠ¸ (ì„ íƒ ì‚¬í•­)
  # videoScale: {width: 1280, height: 720} # í•´ìƒë„ ë³€ê²½ (ì„ íƒ ì‚¬í•­)
  # timeRange: {start: 30.54, end: 634:21}  # ë¹„ë””ì˜¤ ìë¥´ê¸° (ì„ íƒ ì‚¬í•­)

# --- í€„ë¦¬í‹° ì¶”ì • ê¸°ëŠ¥ ì„¤ì • ---
estimate:
  enabled: true            # í€„ë¦¬í‹° ì¶”ì • ê¸°ëŠ¥ í™œì„±í™” ì—¬ë¶€
  priority: compression    # ìš°ì„ ìˆœìœ„ ëª¨ë“œ (compression: ìš©ëŸ‰ ìš°ì„  / quality: í™”ì§ˆ ìš°ì„ )
  qualityRange: [20, 48]   # í€„ë¦¬í‹° íƒìƒ‰ ë²”ìœ„
  sizeRatioRange: [0.32, 0.36] # ëª©í‘œ ì›ë³¸ ëŒ€ë¹„ ìš©ëŸ‰ë¹„ ë²”ìœ„

  # --- í€„ë¦¬í‹° ì¶”ì •ì„ ìœ„í•œ ìƒ˜í”Œ ì¸ì½”ë”© ì„¤ì • ---
  check:
    nParts: 10             # ë¹„ë””ì˜¤ë¥¼ ë‚˜ëˆŒ ì„¸ê·¸ë¨¼íŠ¸ ê°œìˆ˜
    encDuration: "30"      # ê° ì„¸ê·¸ë¨¼íŠ¸ì—ì„œ í…ŒìŠ¤íŠ¸ ì¸ì½”ë”©ì„ ì§„í–‰í•  ì‹œê°„ (ì´ˆ)
```

## â–¶ï¸ Run

### Linux
```sh
export CONFIG_PATH=<config.yaml íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œ>
.venv/bin/python3 -m enct batch
```

### Windows
```shell
set CONFIG_PATH=<config.yaml íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œ>
.venv\Scripts\python.exe -m enct batch
```
